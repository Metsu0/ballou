<?xml version="1.0" encoding="utf-8" ?>
<odoo>
  <data>
    <!--APPOINTMENTS VIEWS AND ACTION-->
    <record id="view_onboarding_appointment_tree" model="ir.ui.view">
      <field name="name">onboarding.appointment.list</field>
      <field name="model">calendar.event</field>
      <field name="inherit_id" ref="calendar.view_calendar_event_tree"/>
      <field name="arch" type="xml">
      	<!-- HRN Comment -->
        <!-- <field name="state" position="attributes">
          <attribute name="invisible">1</attribute>
        </field> -->
        <field name="duration" position="after">
          <field name="status"/>
        </field>
      </field>
    </record>

    <record id="view_onboarding_appointment_form" model="ir.ui.view">
      <field name="name">onboarding.appointment.form</field>
      <field name="model">calendar.event</field>
      <field name="inherit_id" ref="calendar.view_calendar_event_form"/>
      <field name="arch" type="xml">
        <div class="oe_title" position="after">
          <group>
            <div class="o_col">
              <field name="employee_domain" widget="domain" options="{'model': 'hr.employee'}"/>
              <field name="employee_ids"/>
            </div>
          </group>
        </div>
        <field name="start_date" position="before">
          <field name="validation_msg" readonly="1" style="color:red;"
                 attrs="{'invisible': [('validation_msg', '=', '')]}"/>
        </field>
        <field name="start_date" position="attributes">
          <attribute name="attrs">{'required': [('allday','=',True)], 'invisible': ['|', ('allday','=',False),
            ('validation_msg', '!=', '')], 'readonly': [('id', '!=', False), ('recurrency','=',True)]}
          </attribute>
        </field>
        <!-- HRN remove cause no more exist in v14 -->
        <!-- <field name="start_datetime" position="attributes">
          <attribute name="attrs">{'required': [('allday','=',False)], 'invisible': ['|', ('allday','=',True),
            ('validation_msg', '!=', '')], 'readonly': [('id', '!=', False), ('recurrency','=',True)]}
          </attribute>
        </field> -->
        <field name="allday" position="attributes">
          <attribute name="attrs">{'readonly': [('id', '!=', False), '!', ('recurrency','=',True),
            ('validation_msg',
            '!=', '')]}
          </attribute>
        </field>
        <field name="description" position="attributes">
          <attribute name="attrs">
            {'required': 1}
          </attribute>
        </field>
        <xpath expr="//div[hasclass('oe_chatter')]" position="replace">
          <div></div>
        </xpath>
      </field>
    </record>

    <record id="view_onboarding_appointment_kanban" model="ir.ui.view">
      <field name="name">onboarding.appointment.kanban</field>
      <field name="model">calendar.event</field>
      <field name="arch" type="xml">
        <kanban default_group_by="status" class="o_kanban_small_column" disable_drag_drop_record="true">>
          <field name="name"/>
          <templates>
            <t t-name="kanban-box">
              <div class="oe_kanban_card oe_kanban_global_click o_kanban_record_has_image_fill">
                <div class="o_dropdown_kanban dropdown">
                  <a class="dropdown-toggle o-no-caret btn" role="button" data-toggle="dropdown"
                     href="#"
                     aria-label="Dropdown menu" title="Dropdown menu">
                    <span class="fa fa-ellipsis-v"/>
                  </a>
                  <div class="dropdown-menu" role="menu">
                    <t t-if="widget.editable">
                      <a role="menuitem" type="edit" class="dropdown-item">Edit</a>
                    </t>
                    <t t-if="widget.deletable">
                      <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                    </t>
                  </div>
                </div>
                <div class="oe_kanban_content">
                  <div class="o_kanban_record_top">
                    <div class="row" style="width: 100%;">
                      <div class="col-8">
                        <strong class="o_kanban_record_title">
                          <field name="name"/>
                        </strong>
                      </div>
                      <div t-attf-class="col-4 text-center">
                        <field name="start"/>
                      </div>
                    </div>
                  </div>
                  <div class="o_kanban_record_body">
                    <field name="description"/>
                  </div>
                </div>
                <div class="oe_clear"/>
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>

    <record id="view_onboarding_appointment_search" model="ir.ui.view">
      <field name="name">onboarding.appointment.search</field>
      <field name="model">calendar.event</field>
      <field name="arch" type="xml">
        <search string="Search Onboarding Appointment">
          <filter string="Onboarding appointment" name="onboarding_appointment"
                  domain="[('is_onboarding_appointment','=',1)]"/>
        </search>
      </field>
    </record>

    <record id="action_onboarding_appointment" model="ir.actions.act_window">
      <field name="name">Appointments</field>
      <field name="res_model">calendar.event</field>
      <field name="view_mode">kanban,calendar,tree,form</field>
      <field name="view_id" ref="ooto_onboarding.view_onboarding_appointment_kanban"/>
      <field name="search_view_id" ref="view_onboarding_appointment_search"/>
      <field name="context">
        {'search_default_onboarding_appointment':1, 'default_is_onboarding_appointment': True,}
      </field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Schedule a new appointment
        </p>
        <p>
          The calendar is shared between employees and fully integrated with
          other applications such as the employee leaves or the business
          opportunities.
        </p>
      </field>
    </record>

    <!--POSTPONE APPOINTMENTS VIEWS AND ACTION -->

    <record id="view_onboarding_appointment_postpone_tree" model="ir.ui.view">
      <field name="name">onboarding.appointment.postpone.tree</field>
      <field name="model">hr.onboarding.appointment.postpone</field>
      <field name="arch" type="xml">
        <tree string="Appointment Postpone List" create="false" edit="false" default_order='create_date desc'
              decoration-warning="state == 'waiting_for_validation'" decoration-success="state == 'validate'"
              decoration-danger="state == 'refused'">
          <field name="onboarding_appointment_id" string="Subject"/>
          <field name="old_date"/>
          <field name="new_date"/>
          <field name="request_sender_id"/>
          <field name="state"/>
        </tree>
      </field>
    </record>

    <record id="view_onboarding_appointment_postpone_form" model="ir.ui.view">
      <field name="name">onboarding.appointment.postpone.form</field>
      <field name="model">hr.onboarding.appointment.postpone</field>
      <field name="arch" type="xml">
        <form string="Appointment Postpone Form" create="false" edit="false">
          <header>
            <button name="refuse_request" type="object"
                    attrs="{'invisible':[('state','in',['validate', 'refused'])]}"
                    string="Refuse request"/>
            <button name="validate_request" type="object"
                    attrs="{'invisible':[('state','in',['validate', 'refused'])]}"
                    string="Validate request"
                    class="oe_highlight"/>
            <field name="state" widget="statusbar"
                   statusbar_visible="waiting_for_validation,validate,refused"/>
          </header>
          <sheet>
            <h1>
              <field name="onboarding_appointment_id" string="Subject"/>
            </h1>
            <group>
              <group>
                <field name="old_date"/>
                <field name="request_sender_id"/>
              </group>
              <group>
                <field name="new_date"/>
                <label for="validator_ids"/>
                <h4>
                  <field name="validator_ids" widget="many2many_tags"/>
                </h4>
              </group>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <record id="action_onboarding_appointment_postpone" model="ir.actions.act_window">
      <field name="name">Requests to postpone appointment</field>
      <field name="res_model">hr.onboarding.appointment.postpone</field>
      <field name="view_mode">tree,form</field>
      <field name="view_id" ref="view_onboarding_appointment_postpone_tree"/>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          No request yet ...
        </p>
      </field>
    </record>
  </data>
</odoo>